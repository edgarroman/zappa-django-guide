
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A full featured walkthough of using Django on Zappa (powered by AWS Lambda in serverless environment)">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.6">
    
    
      
        <title>Hosting Static Files - Guide to using Django with Zappa</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.875de78c.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.f1a3b89f.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      
        
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-97437653-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#hosting-static-files" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-announce">
          <div class="md-announce__inner md-grid md-typeset">
            
Now Available! Complete video tutorials with my new course: <a
    href="https://www.newline.co/courses/serverless-django-with-zappa/" style="color: #0ee7ff">Newline's Serverless
    Django with Zappa</a>

          </div>
        </aside>
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Guide to using Django with Zappa" class="md-header__button md-logo" aria-label="Guide to using Django with Zappa" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Guide to using Django with Zappa
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Hosting Static Files
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/edgarroman/zappa-django-guide/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    edgarroman/zappa-django-guide
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Guide to using Django with Zappa" class="md-nav__button md-logo" aria-label="Guide to using Django with Zappa" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Guide to using Django with Zappa
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/edgarroman/zappa-django-guide/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    edgarroman/zappa-django-guide
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      <label class="md-nav__link" for="__nav_2">
        Walkthroughs
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Walkthroughs" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Walkthroughs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../setup/" class="md-nav__link">
        Setup your Environment
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../walk_core/" class="md-nav__link">
        Core Django Setup
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Hosting Static Files
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Hosting Static Files
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#static-files-and-code-on-a-single-server" class="md-nav__link">
    Static files and Code on a Single Server
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#leveraging-wsgi-app-to-serve-files" class="md-nav__link">
    Leveraging WSGI app to serve files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-external-services-to-serve-files" class="md-nav__link">
    Using external services to serve files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-a-cdn-for-the-entire-project" class="md-nav__link">
    Using a CDN for the entire project
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-and-prerequisites" class="md-nav__link">
    Setup and Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-amazon-account" class="md-nav__link">
    Setup Amazon Account
  </a>
  
    <nav class="md-nav" aria-label="Setup Amazon Account">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configure-cors" class="md-nav__link">
    Configure CORS
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-django-project" class="md-nav__link">
    Configure Django Project
  </a>
  
    <nav class="md-nav" aria-label="Configure Django Project">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-modules" class="md-nav__link">
    Install modules
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-django-s3-storage-to-the-installed_apps-in-settingspy" class="md-nav__link">
    Add Django-S3-Storage to the INSTALLED_APPS in settings.py
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-django-s3-storage-in-settingspy" class="md-nav__link">
    Configure Django-S3-Storage in settings.py
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#push-your-static-files-to-the-cloud" class="md-nav__link">
    Push your static files to the cloud
  </a>
  
    <nav class="md-nav" aria-label="Push your static files to the cloud">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-with-the-admin" class="md-nav__link">
    Test with the admin
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    Next Steps
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#additional-http-settings" class="md-nav__link">
    Additional HTTP Settings
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../walk_database/" class="md-nav__link">
        Using a Database
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../walk_domain/" class="md-nav__link">
        Custom Domains
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../walk_app/" class="md-nav__link">
        Application Adaptations
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      <label class="md-nav__link" for="__nav_3">
        AWS Setup
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="AWS Setup" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          AWS Setup
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../aws_credentials/" class="md-nav__link">
        Managing Credentials
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../aws_network_primer/" class="md-nav__link">
        Primer on AWS VPC Networking
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../aws_network/" class="md-nav__link">
        Adventures in Networking
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../aws_database/" class="md-nav__link">
        Creating an RDS Database
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../aws_route53/" class="md-nav__link">
        Working with Route53
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../aws_acm/" class="md-nav__link">
        AWS Certificate Manager (ACM)
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../additional/" class="md-nav__link">
        Additional
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#static-files-and-code-on-a-single-server" class="md-nav__link">
    Static files and Code on a Single Server
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#leveraging-wsgi-app-to-serve-files" class="md-nav__link">
    Leveraging WSGI app to serve files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-external-services-to-serve-files" class="md-nav__link">
    Using external services to serve files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-a-cdn-for-the-entire-project" class="md-nav__link">
    Using a CDN for the entire project
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-and-prerequisites" class="md-nav__link">
    Setup and Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-amazon-account" class="md-nav__link">
    Setup Amazon Account
  </a>
  
    <nav class="md-nav" aria-label="Setup Amazon Account">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configure-cors" class="md-nav__link">
    Configure CORS
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-django-project" class="md-nav__link">
    Configure Django Project
  </a>
  
    <nav class="md-nav" aria-label="Configure Django Project">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-modules" class="md-nav__link">
    Install modules
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-django-s3-storage-to-the-installed_apps-in-settingspy" class="md-nav__link">
    Add Django-S3-Storage to the INSTALLED_APPS in settings.py
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-django-s3-storage-in-settingspy" class="md-nav__link">
    Configure Django-S3-Storage in settings.py
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#push-your-static-files-to-the-cloud" class="md-nav__link">
    Push your static files to the cloud
  </a>
  
    <nav class="md-nav" aria-label="Push your static files to the cloud">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-with-the-admin" class="md-nav__link">
    Test with the admin
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    Next Steps
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#additional-http-settings" class="md-nav__link">
    Additional HTTP Settings
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/edgarroman/zappa-django-guide/edit/master/docs/walk_static.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="hosting-static-files">Hosting Static Files<a class="headerlink" href="#hosting-static-files" title="Permanent link">&para;</a></h1>
<p>Generally if you'd like to use your Django project to present a User Interface (UI) then you'll need to display Images and CSS and serve Javascript files.  These are known as <a href="https://docs.djangoproject.com/en/1.10/howto/static-files/deployment/">static files</a> and to deliver them using Zappa is unlike the traditional method of hosting the static files on a Linux or Windows box.  </p>
<h3 id="static-files-and-code-on-a-single-server">Static files and Code on a Single Server<a class="headerlink" href="#static-files-and-code-on-a-single-server" title="Permanent link">&para;</a></h3>
<p>A very common configuration you may see recommended is to have your Django project <a href="https://docs.djangoproject.com/en/1.10/howto/static-files/deployment/#serving-the-site-and-your-static-files-from-the-same-server">deployed on a server with your static files</a>.  Then the advice is to have your web server software (apache, nginx, or other) have special mechanisms to directly serve the static files.  The idea is to have the fast web server software handle delivering the static images to clients and the comparatively slow Django/python code process the more complex views and page content.  </p>
<p>Because Zappa runs in the serverless lambda environment, this approach is not feasible since you cannot configure the web server to handle various url paths differently.  Thus another approach must be taken.</p>
<h3 id="leveraging-wsgi-app-to-serve-files">Leveraging WSGI app to serve files<a class="headerlink" href="#leveraging-wsgi-app-to-serve-files" title="Permanent link">&para;</a></h3>
<p>The situation where one does not have access to the web server software configuration is more common than one may think.  Hosting in a shared environment, or on Platform as a Service (PaaS) like OpenShift may prevent full configuration of the web server to effectively serve static files.  </p>
<p>There are ways to leverage the WSGI application (Django for us) and instruct it to serve static files.  Normally, Django treats URL requests as an opportunity to run python code.  And the python code may have complex logic.  But there is a model called <a href="https://github.com/evansd/whitenoise">WhiteNoise</a>.  It is an app that will minimize the python code processing to more efficiently serve static files.  Thus no external web server software configuration is required.  While perhaps not as optimal as having the web server hosting the files, this method has been used in production effectively.  </p>
<p>However, you must run the <code>manage.py collectstatic</code> command locally before deploying the app. You will also need to set the <code>STATIC_URL</code> and <code>WHITENOISE_STATIC_PREFIX</code> in <code>settings.py</code> to account for the URL that Zappa provides.
<div class="highlight"><pre><span></span><code>STATIC_URL = &#39;/production/static/&#39;       # Use the name of your staging environment (e.g. production)
WHITENOISE_STATIC_PREFIX = &#39;/static/&#39;
</code></pre></div></p>
<h3 id="using-external-services-to-serve-files">Using external services to serve files<a class="headerlink" href="#using-external-services-to-serve-files" title="Permanent link">&para;</a></h3>
<p>Finally, there is an option to use an <a href="https://docs.djangoproject.com/en/1.10/howto/static-files/deployment/#serving-static-files-from-a-cloud-service-or-cdn">external service to serve static files</a>.  This is the option that is the subject of this walkthrough.</p>
<p>While any external service that serves files over HTTP could work, the focus for us will be to leverage the AWS service of S3 and the Content Delivery Network (CDN) of CloudFront to meet our needs.  </p>
<p>The S3 service will contain our files and provide the fundamental HTTP/HTTPS service.  This alone will suffice for many recreational projects, but more professional project will want to leverage CloudFront to provide caching, faster delivery, and better protection of assets.</p>
<p>Note that much of this information was pulled from <a href="https://www.caktusgroup.com/blog/2014/11/10/Using-Amazon-S3-to-store-your-Django-sites-static-and-media-files/">https://www.caktusgroup.com/blog/2014/11/10/Using-Amazon-S3-to-store-your-Django-sites-static-and-media-files/</a></p>
<h3 id="using-a-cdn-for-the-entire-project">Using a CDN for the entire project<a class="headerlink" href="#using-a-cdn-for-the-entire-project" title="Permanent link">&para;</a></h3>
<p>There are also advantages to serving the entire Django project (Lambda functions and S3 Static files) via the CloudFront CDN.  This option will not be covered in this Walkthrough.</p>
<h2 id="setup-and-prerequisites">Setup and Prerequisites<a class="headerlink" href="#setup-and-prerequisites" title="Permanent link">&para;</a></h2>
<p>Make sure you understand and execute the <a href="../walk_core/">Core Django Walkthrough</a> first.  This Walkthrough builds upon that.</p>
<h2 id="setup-amazon-account">Setup Amazon Account<a class="headerlink" href="#setup-amazon-account" title="Permanent link">&para;</a></h2>
<p>You will need an AWS S3 bucket to host your static files.  This should not be the same as your S3 bucket used by zappa to upload your code.  The reason is that you will be making some modifications to the S3 bucket to properly use HTTP to serve files.</p>
<p>Create an S3 bucket and name it something like <code>zappa-static</code>.  You may name it anything you like but for the purposes of this walkthrough we will use <code>zappa-static</code>.  Replace all occurrences of this string with your chosen bucket name.</p>
<h3 id="configure-cors">Configure CORS<a class="headerlink" href="#configure-cors" title="Permanent link">&para;</a></h3>
<p><a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/cors.html">CORS</a> is an HTTP standard that enables browsers to pull content from different sources on a single web page.  Because our Django Lambda views are hosted on a different URL, we must enable the CORS setting on the S3 bucket holding our static assets to allow the files to be pulled.  </p>
<p>Go to your S3 bucket properties, and under "Permissions", click on "Add CORS Configuration". Paste this in:</p>
<p><div class="highlight"><pre><span></span><code> &lt;CORSConfiguration&gt;
        &lt;CORSRule&gt;
            &lt;AllowedOrigin&gt;*&lt;/AllowedOrigin&gt;
            &lt;AllowedMethod&gt;GET&lt;/AllowedMethod&gt;
            &lt;MaxAgeSeconds&gt;3000&lt;/MaxAgeSeconds&gt;
            &lt;AllowedHeader&gt;Authorization&lt;/AllowedHeader&gt;
        &lt;/CORSRule&gt;
    &lt;/CORSConfiguration&gt;
</code></pre></div>
<strong>Note that this CORS policy is very open and simple.  If you have a production site, you will probably want to narrow the scope of CORS or leverage a CDN.</strong></p>
<h2 id="configure-django-project">Configure Django Project<a class="headerlink" href="#configure-django-project" title="Permanent link">&para;</a></h2>
<h3 id="install-modules">Install modules<a class="headerlink" href="#install-modules" title="Permanent link">&para;</a></h3>
<p>In order to re-use existing modules freely available, we will use the <a href="https://github.com/etianen/django-s3-storage">django-s3-storage</a> package to handle the management of files to and from AWS S3.  So first you must install it.  <em>Don't forget to activate your virtual environment</em> </p>
<div class="highlight"><pre><span></span><code>pip install django-s3-storage
</code></pre></div>
<p>And thus you should take the corresponding package versions reported by <code>pip freeze</code> into the requirements.txt file.  At the time of this writing, the additional lines would be:</p>
<div class="highlight"><pre><span></span><code>...
django-s3-storage==0.12.4
...
</code></pre></div>
<h3 id="add-django-s3-storage-to-the-installed_apps-in-settingspy">Add Django-S3-Storage to the INSTALLED_APPS in settings.py<a class="headerlink" href="#add-django-s3-storage-to-the-installed_apps-in-settingspy" title="Permanent link">&para;</a></h3>
<p>Edit your settings.py file to include django-s3-storage.  Note it's  called 'django_s3_storage' as an app.</p>
<div class="highlight"><pre><span></span><code>INSTALLED_APPS = (
          ...,
          &#39;django_s3_storage&#39;,
     )
</code></pre></div>
<h3 id="configure-django-s3-storage-in-settingspy">Configure Django-S3-Storage in settings.py<a class="headerlink" href="#configure-django-s3-storage-in-settingspy" title="Permanent link">&para;</a></h3>
<p>Add these lines anywhere in your settings.py.  These values instruct django-s3-storage to properly configure a basic setup for leveraging S3.  </p>
<div class="highlight"><pre><span></span><code>YOUR_S3_BUCKET = &quot;zappa-static&quot;

STATICFILES_STORAGE = &quot;django_s3_storage.storage.StaticS3Storage&quot;
AWS_S3_BUCKET_NAME_STATIC = YOUR_S3_BUCKET

# These next two lines will serve the static files directly 
# from the s3 bucket
AWS_S3_CUSTOM_DOMAIN = &#39;%s.s3.amazonaws.com&#39; % YOUR_S3_BUCKET
STATIC_URL = &quot;https://%s/&quot; % AWS_S3_CUSTOM_DOMAIN

# OR...if you create a fancy custom domain for your static files use:
#AWS_S3_PUBLIC_URL_STATIC = &quot;https://static.zappaguide.com/&quot;
</code></pre></div>
<h2 id="push-your-static-files-to-the-cloud">Push your static files to the cloud<a class="headerlink" href="#push-your-static-files-to-the-cloud" title="Permanent link">&para;</a></h2>
<p>The funny thing about zappa is that generally you have a working local environment and a working lambda environment.  In theory either location can push the static files to the cloud.  </p>
<p>Using your local environment:</p>
<div class="highlight"><pre><span></span><code>python manage.py collectstatic --noinput
</code></pre></div>
<p>Or to instruct your zappa-powered AWS lambda environment to do it for you (don't forget to push your code changes first)</p>
<div class="highlight"><pre><span></span><code>zappa update dev
zappa manage dev &quot;collectstatic --noinput&quot;
</code></pre></div>
<h3 id="test-with-the-admin">Test with the admin<a class="headerlink" href="#test-with-the-admin" title="Permanent link">&para;</a></h3>
<p>Once you have pushed your static files to S3, you can visit the admin site for your Django project to test if it worked.  Appending /admin/ to your zappa project you can now browse to the admin site and watch the css being loaded just fine.</p>
<p><img alt="success" src="../images/static_django.png" /></p>
<h2 id="next-steps">Next Steps<a class="headerlink" href="#next-steps" title="Permanent link">&para;</a></h2>
<p>Well great, now you have a working Django site that processes views and can serve static files.  But you can't login because there is no database.  Continue through the walkthroughs to complete a fully functional website.</p>
<h2 id="additional-http-settings">Additional HTTP Settings<a class="headerlink" href="#additional-http-settings" title="Permanent link">&para;</a></h2>
<p>As mentioned above you probably want to ensure a valid CORS policy is in place for anything resembling production.</p>
<p>In addition there are many default HTTP headers that can be served with your static files to ensure proper caching and so forth.  The example format in your settings.py file is:</p>
<div class="highlight"><pre><span></span><code>AWS_S3_MAX_AGE_SECONDS_STATIC = &quot;94608000&quot;
</code></pre></div>
<p>See the <a href="https://github.com/etianen/django-s3-storage">django-s3-storage</a> for more settings.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../walk_core/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Core Django Setup
            </div>
          </div>
        </a>
      
      
        <a href="../walk_database/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Using a Database
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; <script>document.write(new Date().getFullYear())</script> <a href="https://github.com/edgarroman">Edgar Roman</a>
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/edgarroman" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../assets/javascripts/workers/search.d351de03.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.34eae1b6.min.js"></script>
      
    
  </body>
</html>