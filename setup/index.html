
<!DOCTYPE html>
<html class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A full featured walkthough of using Django on Zappa (powered by AWS Lambda in serverless environment)">
      
      
      
      
        <link rel="shortcut icon" href="../assets/images/favicon.png">
      
      <meta name="generator" content="mkdocs-0.16.3, mkdocs-material-1.5.4">
    
    
      
        <title>Setup your Environment - Guide to using Django with Zappa</title>
      
    
    
      <script src="../assets/javascripts/modernizr-56ade86843.js"></script>
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application-b1a1975878.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-f78e5cb881.palette.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
  
  
  
    <body data-md-color-primary="deep-purple" data-md-color-accent="">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <a href=".." title="Guide to using Django with Zappa" class="md-icon md-icon--home md-header-nav__button">
          </a>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Walkthroughs
                </span>
              
            
            Setup your Environment
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <div class="md-search__overlay"></div>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">close</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <div class="md-header-nav__source">
          
            


  


  <a href="https://github.com/edgarroman/zappa-django-guide" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      edgarroman/zappa-django-guide
    </div>
  </a>

          
        </div>
      </div>
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href=".." title="Home" class="md-tabs__link">
        Home
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="./" title="Walkthroughs" class="md-tabs__link md-tabs__link--active">
          Walkthroughs
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../aws_credentials/" title="AWS Setup" class="md-tabs__link">
          AWS Setup
        </a>
      
    </li>
  

      
        
      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    
      <i class="md-icon md-icon--home md-nav__button"></i>
    
    Guide to using Django with Zappa
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/edgarroman/zappa-django-guide" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      edgarroman/zappa-django-guide
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Walkthroughs
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Walkthroughs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Setup your Environment
      </label>
    
    <a href="./" title="Setup your Environment" class="md-nav__link md-nav__link--active">
      Setup your Environment
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#why-do-i-need-a-working-environment" title="Why do I need a working environment?" class="md-nav__link">
    Why do I need a working environment?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#baseline-packages" title="Baseline packages" class="md-nav__link">
    Baseline packages
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#approach-1-local-machine" title="Approach #1 - Local Machine" class="md-nav__link">
    Approach #1 - Local Machine
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#approach-2-docker-with-zappa-recommended" title="Approach #2 - Docker with zappa (recommended)" class="md-nav__link">
    Approach #2 - Docker with zappa (recommended)
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inital-setup" title="Inital Setup" class="md-nav__link">
    Inital Setup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#taking-a-test-drive" title="Taking a test drive" class="md-nav__link">
    Taking a test drive
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#project-setup" title="Project Setup" class="md-nav__link">
    Project Setup
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-a-dockerfile" title="Create a Dockerfile" class="md-nav__link">
    Create a Dockerfile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-the-docker-image" title="Build the docker image" class="md-nav__link">
    Build the docker image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-your-zappashell-alias" title="Update your zappashell alias" class="md-nav__link">
    Update your zappashell alias
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-the-virtual-environment" title="Create the Virtual Environment" class="md-nav__link">
    Create the Virtual Environment
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-your-environment" title="Using your environment" class="md-nav__link">
    Using your environment
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../walk_core/" title="Core Django Setup" class="md-nav__link">
      Core Django Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../walk_static/" title="Hosting Static Files" class="md-nav__link">
      Hosting Static Files
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../walk_database/" title="Using a Database" class="md-nav__link">
      Using a Database
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../walk_domain/" title="Custom Domains" class="md-nav__link">
      Custom Domains
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../walk_app/" title="Application Adaptations" class="md-nav__link">
      Application Adaptations
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      AWS Setup
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        AWS Setup
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../aws_credentials/" title="Managing Credentials" class="md-nav__link">
      Managing Credentials
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../aws_network/" title="Adventures in Networking" class="md-nav__link">
      Adventures in Networking
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../aws_database/" title="Creating an RDS Database" class="md-nav__link">
      Creating an RDS Database
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../aws_route53/" title="Working with Route53" class="md-nav__link">
      Working with Route53
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../aws_acm/" title="AWS Credential Manager (ACM)" class="md-nav__link">
      AWS Credential Manager (ACM)
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../additional/" title="Additional" class="md-nav__link">
      Additional
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#why-do-i-need-a-working-environment" title="Why do I need a working environment?" class="md-nav__link">
    Why do I need a working environment?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#baseline-packages" title="Baseline packages" class="md-nav__link">
    Baseline packages
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#approach-1-local-machine" title="Approach #1 - Local Machine" class="md-nav__link">
    Approach #1 - Local Machine
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#approach-2-docker-with-zappa-recommended" title="Approach #2 - Docker with zappa (recommended)" class="md-nav__link">
    Approach #2 - Docker with zappa (recommended)
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inital-setup" title="Inital Setup" class="md-nav__link">
    Inital Setup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#taking-a-test-drive" title="Taking a test drive" class="md-nav__link">
    Taking a test drive
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#project-setup" title="Project Setup" class="md-nav__link">
    Project Setup
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-a-dockerfile" title="Create a Dockerfile" class="md-nav__link">
    Create a Dockerfile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-the-docker-image" title="Build the docker image" class="md-nav__link">
    Build the docker image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-your-zappashell-alias" title="Update your zappashell alias" class="md-nav__link">
    Update your zappashell alias
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-the-virtual-environment" title="Create the Virtual Environment" class="md-nav__link">
    Create the Virtual Environment
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-your-environment" title="Using your environment" class="md-nav__link">
    Using your environment
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="setup-your-environment">Setup your Environment<a class="headerlink" href="#setup-your-environment" title="Permanent link">&para;</a></h1>
<p>This section provides guidance to set up a zappa working environment.</p>
<h2 id="why-do-i-need-a-working-environment">Why do I need a working environment?<a class="headerlink" href="#why-do-i-need-a-working-environment" title="Permanent link">&para;</a></h2>
<p>While the ultimate goal is to have your Django application hosted in a cloud-based serverless environment, a working environment is needed to:</p>
<ul>
<li>Collect the required packages</li>
<li>Build a lambda compatible deployment</li>
<li>Upload the deployment </li>
<li>Coordinate the various AWS services to enable the cloud-based environment</li>
</ul>
<p>In addition, a working environment assists with development and testing.  The caveat is that this working environment will not match exactly the cloud-based deployment. However, the goal is to get a reasonablly close approximation while still balancing ease of use.</p>
<h2 id="baseline-packages">Baseline packages<a class="headerlink" href="#baseline-packages" title="Permanent link">&para;</a></h2>
<p>To ensure baseline expectations are set, all environments will assume the following criteria:</p>
<ul>
<li>Python 3.6 or 2.7 (according to <a href="http://docs.aws.amazon.com/lambda/latest/dg/current-supported-versions.html">AWS lambda support</a>) </li>
<li>Django 1.10</li>
<li>Latest version of <a href="https://pypi.python.org/pypi/zappa">zappa</a></li>
</ul>
<p>In addition, zappa <em>requires</em> a virtual environment in which to function.  So all approaches below include a virtual environment.  </p>
<h2 id="approach-1-local-machine">Approach #1 - Local Machine<a class="headerlink" href="#approach-1-local-machine" title="Permanent link">&para;</a></h2>
<p>You can easily set up your working environment on your local machine. For simple projects, this is very easy to manage and maintain.  All you need is Python 2.7, pip, and virtualenv installed.  This works for Windows, MacOS, and Linux machines.  </p>
<p>Here we setup a working environment named 'zappatest'</p>
<p><div class="codehilite"><pre><span></span>mkdir zappatest
<span class="nb">cd</span> zappatest
virtualenv ve
<span class="nb">source</span> ve/bin/activate
pip install django zappa
</pre></div>

And you are done.  </p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>While this approach is easy to get up and running, the challenge comes along when you require more advanced python packages.  </p>
<p>For example, once you start connecting to databases, you will need to compile packages such as 'psycopg2' for PostGresSQL.  You should consider the implications of installing needed libraries on your local machine.</p>
<p>This is approach is not recommended for any type of serious zappa effort.</p>
</div>
<h2 id="approach-2-docker-with-zappa-recommended">Approach #2 - Docker with zappa (recommended)<a class="headerlink" href="#approach-2-docker-with-zappa-recommended" title="Permanent link">&para;</a></h2>
<p>Sometimes leveraging Docker to create an isolated working environment is a good idea.  It takes more work to setup initially, but once you have the foundations, it is quite easy to create multiple working environments and it is easier to share those same environments with other folks on your team.  </p>
<p>The main goal of using Docker is to create an environment that closely matches the AWS lambda environment.  The closer it matches, then there will be less difficult-to-debug problems. </p>
<p>We will leverage the work others have done to enable such an environment.  First and foremost, the folks from <a href="https://github.com/lambci/lambci">lambci</a> have created github repo called <a href="https://github.com/lambci/docker-lambda">docker-lambda</a> that accurately reflects the lambda environment.  It provides:</p>
<ul>
<li>Multiple uses<ul>
<li>A 'build' image for compilation, package creation, and deployment</li>
<li>A 'run' image for testing and execution of your code</li>
</ul>
</li>
</ul>
<p>For the purposes of this walkthrough we will focus only on the 'build' image that provides a very nice interactive working environment for zappa.  Further research into how to use the 'run' image is left as an exercise for the reader.</p>
<ul>
<li>Multiple Python version support<ul>
<li>Python 2.7 (<a href="https://hub.docker.com/r/lambci/lambda/tags/">lambci/lambda:build-python2.7</a>)</li>
<li>Python 3.6 (<a href="https://hub.docker.com/r/lambci/lambda/tags/">lambci/lambda:build-python3.6</a>)</li>
</ul>
</li>
</ul>
<p>Note that this work was originally inspired from <a href="https://github.com/danielwhatmuff/zappa">danielwhatmuff/zappa</a> but has been enhanced to illustrate support for Python 3.6</p>
<h3 id="inital-setup">Inital Setup<a class="headerlink" href="#inital-setup" title="Permanent link">&para;</a></h3>
<p>These steps need to be performed once for a new system</p>
<ul>
<li><a href="https://docs.docker.com/engine/installation/">Install Docker</a></li>
<li>Pull the zappa docker image from Docker github
<div class="codehilite"><pre><span></span><span class="c1"># For Python 2.7 projects</span>
docker pull lambci/lambda:build-python2.7
<span class="c1"># For Python 3.6 projects</span>
docker pull lambci/lambda:build-python3.6
</pre></div>
</li>
<li>
<p>Create a shortcut that allows AWS credentials to pass through to the docker container</p>
<ul>
<li>
<p>If you use <a href="../aws_credentials#setup-local-account-credentials">environment variables for AWS Credentials</a> then use:
<div class="codehilite"><pre><span></span><span class="nb">alias</span> <span class="nv">zappashell2</span><span class="o">=</span><span class="s1">&#39;docker run -ti -e AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY -e AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID -e AWS_DEFAULT_REGION=$AWS_DEFAULT_REGION -v $(pwd):/var/task  --rm lambci/lambda:build-python2.7 bash&#39;</span>
<span class="nb">alias</span> zappashell2 &gt;&gt; ~/.bash_profile
<span class="nb">alias</span> <span class="nv">zappashell3</span><span class="o">=</span><span class="s1">&#39;docker run -ti -e AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY -e AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID -e AWS_DEFAULT_REGION=$AWS_DEFAULT_REGION -v $(pwd):/var/task  --rm lambci/lambda:build-python3.6 bash&#39;</span>
<span class="nb">alias</span> zappashell3 &gt;&gt; ~/.bash_profile
</pre></div>

Be sure to define the <code>$AWS_DEFAULT_REGION</code> environment variable</p>
</li>
<li>
<p>If you use a <a href="../aws_credentials#setup-local-account-credentials">credentials file for AWS Credentials</a> then use:
<div class="codehilite"><pre><span></span><span class="nb">alias</span> <span class="nv">zappashell2</span><span class="o">=</span><span class="s1">&#39;docker run -ti -e AWS_PROFILE=$AWS_PROFILE -v $(pwd):/var/task -v ~/.aws/:/root/.aws  --rm lambci/lambda:build-python2.7 bash&#39;</span>
<span class="nb">alias</span> zappashell2 &gt;&gt; ~/.bash_profile
<span class="nb">alias</span> <span class="nv">zappashell3</span><span class="o">=</span><span class="s1">&#39;docker run -ti -e AWS_PROFILE=$AWS_PROFILE -v $(pwd):/var/task -v ~/.aws/:/root/.aws  --rm lambci/lambda:build-python3.6 bash&#39;</span>
<span class="nb">alias</span> zappashell3 &gt;&gt; ~/.bash_profile
</pre></div>

Note that you must either define the <code>$AWS_PROFILE</code> environment variable or edit the alias above to be hardcoded to a specific profile.  Example of hardcoding the alias:
<div class="codehilite"><pre><span></span><span class="nb">alias</span> <span class="nv">zappashell3</span><span class="o">=</span><span class="s1">&#39;docker run -ti -e AWS_PROFILE=zappa -v $(pwd):/var/task -v ~/.aws/:/root/.aws  --rm lambci/lambda:build-python3.6 bash&#39;</span>
</pre></div>
</p>
</li>
</ul>
</li>
</ul>
<h3 id="taking-a-test-drive">Taking a test drive<a class="headerlink" href="#taking-a-test-drive" title="Permanent link">&para;</a></h3>
<p>So let's try this out now.  Examples going forward will focus on Python 3.6.  To fire up the docker container use:</p>
<div class="codehilite"><pre><span></span>$ <span class="nb">cd</span> /your_zappa_project
$ zappashell3
bash-4.2# 
</pre></div>


<p>Next, create the <em>required</em> virtual environment, activate it, and install needed dependencies</p>
<div class="codehilite"><pre><span></span>bash-4.2# virtualenv ve
bash-4.2# <span class="nb">source</span> ve/bin/activate 
<span class="o">(</span>ve<span class="o">)</span> bash-4.2# pip install -r requirements.txt
</pre></div>


<p>Since the virtual environment is contained in the current directory, and the current directory is mapped to your local machine, any changes you make will be persisted between Docker container instances.  But if you depend on libraries that are installed in the system (essentially anything out of the current directory and virtual environment), they will be lost when the container exits.  The solution for this is to create a custom Dockerfile (see below)</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>It is very important that you install and activate the virtualenv only in the docker shell.  This will prevent any incompatibilities with the local system environment and the docker environment.</p>
</div>
<p>At this point, you are ready to start using zappa.  Once you are finished, you can simply exit the container.</p>
<h3 id="project-setup">Project Setup<a class="headerlink" href="#project-setup" title="Permanent link">&para;</a></h3>
<p>Once the steps above are complete, then it is very easy to start a working environment.  But generally additional steps are required for package compilation and customizations.</p>
<h4 id="create-a-dockerfile">Create a Dockerfile<a class="headerlink" href="#create-a-dockerfile" title="Permanent link">&para;</a></h4>
<p>Create a local Dockerfile for your project so you can easily modify needed libraries.  Generally this can go in the root of your zappa project.</p>
<div class="codehilite"><pre><span></span><span class="k">FROM</span><span class="s"> lambci/lambda:build-python3.6</span>

<span class="k">MAINTAINER</span><span class="s"> &quot;Your Name&quot; &lt;your@email.com&gt;</span>

<span class="k">WORKDIR</span><span class="s"> /var/task</span>

<span class="c"># Fancy prompt to remind you are in zappashell</span>
<span class="k">RUN</span> <span class="nb">echo</span> <span class="s1">&#39;export PS1=&quot;\[\e[36m\]zappashell&gt;\[\e[m\] &quot;&#39;</span> &gt;&gt; /root/.bashrc

<span class="c"># Additional RUN commands here</span>
<span class="c"># RUN yum clean all &amp;&amp; \</span>
<span class="c">#    yum -y install &lt;stuff&gt;</span>

<span class="k">CMD</span><span class="s"> [&quot;bash&quot;]</span>
</pre></div>


<h4 id="build-the-docker-image">Build the docker image<a class="headerlink" href="#build-the-docker-image" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span>$ <span class="nb">cd</span> /your_zappa_project
$ docker built -t myzappa .
</pre></div>


<p>This will create a local Docker image on your system. </p>
<h4 id="update-your-zappashell-alias">Update your zappashell alias<a class="headerlink" href="#update-your-zappashell-alias" title="Permanent link">&para;</a></h4>
<p>To make sure it points to your new image.  Essentially replace <code>lambci/lambda:build-python3.6</code> with <code>myzappa</code>.  Example:
<div class="codehilite"><pre><span></span><span class="nb">alias</span> <span class="nv">zappashell</span><span class="o">=</span><span class="s1">&#39;docker run -ti -e AWS_PROFILE=zappa -v $(pwd):/var/task -v ~/.aws/:/root/.aws  --rm myzappa&#39;</span>
<span class="nb">alias</span> zappashell &gt;&gt; ~/.bash_profile
</pre></div>
</p>
<h4 id="create-the-virtual-environment">Create the Virtual Environment<a class="headerlink" href="#create-the-virtual-environment" title="Permanent link">&para;</a></h4>
<p>Create the <em>required</em> virtual environment, activate it, and install needed dependencies</p>
<div class="codehilite"><pre><span></span>$ zappashell
zappashell&gt; python -m venv ve
zappashell&gt; <span class="nb">source</span> ve/bin/activate 
<span class="o">(</span>ve<span class="o">)</span> zappa&gt; pip install -r requirements.txt
</pre></div>


<p>Since the virtual environment is contained in the current directory, and the current directory is mapped to your local machine, any changes you make will be persisted between Docker container instances.  But if you depend on libraries that are installed in the system (essentially anything out of the current directory and virtual environment), they will be lost when the container exits.  The solution for this is to add these installations as RUN commands in the Dockerfile.</p>
<h3 id="using-your-environment">Using your environment<a class="headerlink" href="#using-your-environment" title="Permanent link">&para;</a></h3>
<p>Each time you are working on your project, merely fire up the container:</p>
<div class="codehilite"><pre><span></span>$ <span class="nb">cd</span> /your_zappa_project
$ zappashell
zappashell&gt; <span class="nb">source</span> ve/bin/activate
<span class="o">(</span>ve<span class="o">)</span> zappashell&gt; 
</pre></div>


<p>All zappa commands can be used to deploy your project:</p>
<div class="codehilite"><pre><span></span><span class="o">(</span>ve<span class="o">)</span> zappashell&gt; zappa info dev
</pre></div>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href=".." title="Home" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Home
              </span>
            </div>
          </a>
        
        
          <a href="../walk_core/" title="Core Django Setup" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Core Django Setup
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2016 - 2017 <a href="https://github.com/edgarroman">Edgar Roman</a>
          </div>
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="https://github.com/edgarroman" class="md-footer-social__link fa fa-github"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application-0b7df094bf.js"></script>
      <script>app.initialize({url:{base:".."}})</script>
      
    
    
      
      <script>!function(e,t,a,n,o,c,i){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,c=t.createElement(a),i=t.getElementsByTagName(a)[0],c.async=1,c.src=n,i.parentNode.insertBefore(c,i)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-97437653-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var t=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",t,e.href)})});var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})</script>
      
    
  </body>
</html>