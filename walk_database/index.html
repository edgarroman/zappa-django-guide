
<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="A full featured walkthough of using Django on Zappa (powered by AWS Lambda in serverless environment)">
      
      
      
      
        <link rel="shortcut icon" href="../assets/images/favicon.png">
      
      <meta name="generator" content="mkdocs-0.16.3, mkdocs-material-1.7.4">
    
    
      
        <title>Using a Database - Guide to using Django with Zappa</title>
      
    
    
      <script src="../assets/javascripts/modernizr-1df76c4e58.js"></script>
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application-769c285a91.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-02c2a4388f.palette.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
  
  
  
    <body data-md-color-primary="deep-purple" data-md-color-accent="">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <a href=".." title="Guide to using Django with Zappa" class="md-icon md-icon--home md-header-nav__button">
          </a>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Walkthroughs
                </span>
              
            
            Using a Database
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">close</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result" data-md-lang-search="">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/edgarroman/zappa-django-guide" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      edgarroman/zappa-django-guide
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href=".." title="Home" class="md-tabs__link">
        Home
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../setup/" title="Walkthroughs" class="md-tabs__link md-tabs__link--active">
          Walkthroughs
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../aws_credentials/" title="AWS Setup" class="md-tabs__link">
          AWS Setup
        </a>
      
    </li>
  

      
        
      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    
      <i class="md-icon md-icon--home md-nav__button"></i>
    
    Guide to using Django with Zappa
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/edgarroman/zappa-django-guide" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      edgarroman/zappa-django-guide
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Walkthroughs
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Walkthroughs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../setup/" title="Setup your Environment" class="md-nav__link">
      Setup your Environment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../walk_core/" title="Core Django Setup" class="md-nav__link">
      Core Django Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../walk_static/" title="Hosting Static Files" class="md-nav__link">
      Hosting Static Files
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Using a Database
      </label>
    
    <a href="./" title="Using a Database" class="md-nav__link md-nav__link--active">
      Using a Database
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" title="Prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#options-for-databases" title="Options for Databases" class="md-nav__link">
    Options for Databases
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use-aws-rds" title="Use AWS RDS" class="md-nav__link">
    Use AWS RDS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#host-your-own" title="Host Your Own" class="md-nav__link">
    Host Your Own
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-another-db-service" title="Use another DB Service" class="md-nav__link">
    Use another DB Service
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-your-rds-database" title="Create your RDS Database" class="md-nav__link">
    Create your RDS Database
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configure-rds-security-group" title="Configure RDS security group" class="md-nav__link">
    Configure RDS security group
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary-data" title="Summary Data" class="md-nav__link">
    Summary Data
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-your-configuration" title="Setup your Configuration" class="md-nav__link">
    Setup your Configuration
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#edit-requirements" title="Edit requirements" class="md-nav__link">
    Edit requirements
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django-settings" title="Django Settings" class="md-nav__link">
    Django Settings
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zappa-settings" title="Zappa Settings" class="md-nav__link">
    Zappa Settings
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-your-database" title="Create your Database" class="md-nav__link">
    Create your Database
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-aws-command-line-tool" title="Using AWS command line tool" class="md-nav__link">
    Using AWS command line tool
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup-the-database-using-zappa" title="Setup the Database using zappa" class="md-nav__link">
    Setup the Database using zappa
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-a-management-command-in-your-django-project" title="Create a management command in your Django Project" class="md-nav__link">
    Create a management command in your Django Project
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-the-management-command" title="Run the management command" class="md-nav__link">
    Run the management command
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#init-the-database" title="Init the Database" class="md-nav__link">
    Init the Database
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-your-django-superuser" title="Create your Django superuser" class="md-nav__link">
    Create your Django superuser
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-and-profit" title="Test and profit" class="md-nav__link">
    Test and profit
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../walk_domain/" title="Custom Domains" class="md-nav__link">
      Custom Domains
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../walk_app/" title="Application Adaptations" class="md-nav__link">
      Application Adaptations
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      AWS Setup
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        AWS Setup
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../aws_credentials/" title="Managing Credentials" class="md-nav__link">
      Managing Credentials
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../aws_network_primer/" title="Primer on AWS VPC Networking" class="md-nav__link">
      Primer on AWS VPC Networking
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../aws_network/" title="Adventures in Networking" class="md-nav__link">
      Adventures in Networking
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../aws_database/" title="Creating an RDS Database" class="md-nav__link">
      Creating an RDS Database
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../aws_route53/" title="Working with Route53" class="md-nav__link">
      Working with Route53
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../aws_acm/" title="AWS Credential Manager (ACM)" class="md-nav__link">
      AWS Credential Manager (ACM)
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../additional/" title="Additional" class="md-nav__link">
      Additional
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" title="Prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#options-for-databases" title="Options for Databases" class="md-nav__link">
    Options for Databases
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use-aws-rds" title="Use AWS RDS" class="md-nav__link">
    Use AWS RDS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#host-your-own" title="Host Your Own" class="md-nav__link">
    Host Your Own
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-another-db-service" title="Use another DB Service" class="md-nav__link">
    Use another DB Service
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-your-rds-database" title="Create your RDS Database" class="md-nav__link">
    Create your RDS Database
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configure-rds-security-group" title="Configure RDS security group" class="md-nav__link">
    Configure RDS security group
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary-data" title="Summary Data" class="md-nav__link">
    Summary Data
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-your-configuration" title="Setup your Configuration" class="md-nav__link">
    Setup your Configuration
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#edit-requirements" title="Edit requirements" class="md-nav__link">
    Edit requirements
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#django-settings" title="Django Settings" class="md-nav__link">
    Django Settings
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zappa-settings" title="Zappa Settings" class="md-nav__link">
    Zappa Settings
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-your-database" title="Create your Database" class="md-nav__link">
    Create your Database
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-aws-command-line-tool" title="Using AWS command line tool" class="md-nav__link">
    Using AWS command line tool
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup-the-database-using-zappa" title="Setup the Database using zappa" class="md-nav__link">
    Setup the Database using zappa
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-a-management-command-in-your-django-project" title="Create a management command in your Django Project" class="md-nav__link">
    Create a management command in your Django Project
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-the-management-command" title="Run the management command" class="md-nav__link">
    Run the management command
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#init-the-database" title="Init the Database" class="md-nav__link">
    Init the Database
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-your-django-superuser" title="Create your Django superuser" class="md-nav__link">
    Create your Django superuser
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-and-profit" title="Test and profit" class="md-nav__link">
    Test and profit
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="using-a-database">Using a Database<a class="headerlink" href="#using-a-database" title="Permanent link">&para;</a></h1>
<p>This walkthough documents the steps necessary to connect your application to a hosted database.</p>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">&para;</a></h2>
<p>This walkthough requires the <a href="../walk_core/">Core Django Setup</a> to be completed.  Also, it is important 
to have your network setup properly so check out <a href="../aws_network/">Adventures in Networking</a>.  </p>
<p>We will assume you have chosen the VPC pattern: "VPC with a Public subnet and Private subnet"
But basically you will need the private subnet or subnets which can access the database.</p>
<h2 id="options-for-databases">Options for Databases<a class="headerlink" href="#options-for-databases" title="Permanent link">&para;</a></h2>
<h3 id="use-aws-rds">Use AWS RDS<a class="headerlink" href="#use-aws-rds" title="Permanent link">&para;</a></h3>
<p>This is probably the easiest to get up and running.  AWS takes care of the messy details of managing the host and provides database-as-a-service (if that's a real thing).  In addition, AWS RDS supports mySQL and PostGreSQL, both which are highly compatible with Django.  </p>
<h3 id="host-your-own">Host Your Own<a class="headerlink" href="#host-your-own" title="Permanent link">&para;</a></h3>
<p>Of course you can be running any type of database on an EC2 instance of your choosing.  Usually an EC2 instance will be associated with one subnet, but it is possible to have multiple IP addresses in different subnets for redundancy.</p>
<h3 id="use-another-db-service">Use another DB Service<a class="headerlink" href="#use-another-db-service" title="Permanent link">&para;</a></h3>
<p>There as some other database services such as DynamoDB.  Depending on the capabilities of the service, you may or may need the subnet information.  </p>
<h2 id="create-your-rds-database">Create your RDS Database<a class="headerlink" href="#create-your-rds-database" title="Permanent link">&para;</a></h2>
<p>We'll just focus on the RDS case for this walkthough.  In fact we'll go through the walkthough using PostGreSQL.</p>
<p>So zip on over to <a href="../aws_database/">Creating an RDS Database</a> and set up one.  You should record some key information we'll need here:</p>
<ul>
<li>The subnets (there should be at least two) in which we can access the database</li>
<li>The endpoint (hostname) of the database and the port</li>
<li>The username and password for the root user</li>
</ul>
<h3 id="configure-rds-security-group">Configure RDS security group<a class="headerlink" href="#configure-rds-security-group" title="Permanent link">&para;</a></h3>
<p>By default newly created RDS Security Groups <a href="http://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Overview.RDSSecurityGroups.html">have no inbound access</a>.  So you need
to make sure your RDS Security group has open TCP connections from your subnets associated with the lambdas.  </p>
<p>So your inbound rules on the RDS security may look like:</p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Protocol</th>
<th>Port Range</th>
<th>Source</th>
</tr>
</thead>
<tbody>
<tr>
<td>All TCP</td>
<td>TCP</td>
<td>5432</td>
<td>sg9a9a1dfc</td>
</tr>
</tbody>
</table>
<p>We open the whole range associated with the security group because when a lambda container is created, it could take any free address
in the subnet range.</p>
<h3 id="summary-data">Summary Data<a class="headerlink" href="#summary-data" title="Permanent link">&para;</a></h3>
<p>Note that at this point you don't yet have a database installed on your RDS instance.  So let's just pick a name we will use for the walkthough.  </p>
<p>Here is our sample data:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Sample value</th>
</tr>
</thead>
<tbody>
<tr>
<td>subnets</td>
<td>subnet-f3446aba, subnet-c5b8c79e</td>
</tr>
<tr>
<td>security group</td>
<td>sg9a9a1dfc</td>
</tr>
<tr>
<td>endpoint</td>
<td>zappa-db.crt239fsjdlk.us-east-1.rds.amazonaws.com</td>
</tr>
<tr>
<td>db username</td>
<td>administrator</td>
</tr>
<tr>
<td>db password</td>
<td>this_is_not_a_good_password</td>
</tr>
<tr>
<td>db name</td>
<td>zappadbname</td>
</tr>
</tbody>
</table>
<h2 id="setup-your-configuration">Setup your Configuration<a class="headerlink" href="#setup-your-configuration" title="Permanent link">&para;</a></h2>
<h3 id="edit-requirements">Edit requirements<a class="headerlink" href="#edit-requirements" title="Permanent link">&para;</a></h3>
<p>Note on PostGreSQL: because the psycopg2 library often involves compiling the library, I would suggest using the <a href="../setup/#approach-2-docker-with-zappa">Docker version of zappa</a> to ensure you have isolation of environments and you don't mess up your local system.</p>
<p>Add this to your requirements.txt 
<div class="codehilite"><pre><span></span>psycopg2
</pre></div></p>
<p>and then</p>
<div class="codehilite"><pre><span></span>pip install -r requirements.txt
</pre></div>

<h3 id="django-settings">Django Settings<a class="headerlink" href="#django-settings" title="Permanent link">&para;</a></h3>
<p>Add the above settings to your settings.py.  This is pretty standard Django db stuff.</p>
<div class="codehilite"><pre><span></span>DATABASES = {
    &#39;default&#39;: {
        &#39;ENGINE&#39;: &#39;django.db.backends.postgresql_psycopg2&#39;,
        &#39;NAME&#39;: &#39;zappadbname&#39;,
        &#39;USER&#39;: &#39;administrator&#39;,
        &#39;PASSWORD&#39;: &#39;this_is_not_a_good_password&#39;,
        &#39;HOST&#39;: &#39;zappa-db.crt239fsjdlk.us-east-1.rds.amazonaws.com&#39;,
        &#39;PORT&#39;: &#39;5432&#39;,
    }

}
</pre></div>

<h3 id="zappa-settings">Zappa Settings<a class="headerlink" href="#zappa-settings" title="Permanent link">&para;</a></h3>
<p>Now we add the VPC configuration to our Zappa settings file so that the lambda functions can connect to the database.</p>
<div class="codehilite"><pre><span></span>{
    &quot;dev&quot;: {
        &quot;django_settings&quot;: &quot;frankie.settings&quot;, 
        &quot;s3_bucket&quot;: &quot;zappatest-code&quot;,
        &quot;aws_region&quot;: &quot;us-east-1&quot;,
<span class="hll">        &quot;vpc_config&quot; : {
</span><span class="hll">            &quot;SubnetIds&quot;: [ &quot;subnet-f3446aba&quot;,&quot;subnet-c5b8c79e&quot; ], // use the private subnet
</span><span class="hll">            &quot;SecurityGroupIds&quot;: [ &quot;sg-9a9a1dfc&quot; ]
</span><span class="hll">        }
</span>    }
}
</pre></div>

<h2 id="create-your-database">Create your Database<a class="headerlink" href="#create-your-database" title="Permanent link">&para;</a></h2>
<p>Ok, easy so far?  Yes!  All we had to do up to this point was carefully click a mouse in the AWS console and 
edit some text files.  Well fun time is over - now we run into some bootstrapping problems.  Fortunately, we only have to do this once each time we need a new database.</p>
<p>Turns out that when AWS creates a PostGreSQL RDS instance for you, it doesn't create a database.  So you have to do it yourself.  There are many options, but two methods could be:</p>
<ol>
<li>Use a db tool on your local machine via a bastion host </li>
<li>Use the AWS command line tool</li>
<li>Write some code to setup the database using zappa</li>
</ol>
<p>Option 1 is easy if you have the db tool and the bastion host setup.  But let's explore how to do options two and three.</p>
<h3 id="using-aws-command-line-tool">Using AWS command line tool<a class="headerlink" href="#using-aws-command-line-tool" title="Permanent link">&para;</a></h3>
<p>You can only use the AWS command line tool to create the database if you are also creating the entire RDS instance.  Be sure to identify the database name to create with '<a href="http://docs.aws.amazon.com/cli/latest/reference/rds/create-db-instance.html#options">db-name</a>'</p>
<p>Simply use the <code>aws</code> command tool using syntax similar to
<a href="http://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_CreateInstance.html#USER_CreateInstance.CLI">http://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_CreateInstance.html#USER_CreateInstance.CLI</a></p>
<h3 id="setup-the-database-using-zappa">Setup the Database using zappa<a class="headerlink" href="#setup-the-database-using-zappa" title="Permanent link">&para;</a></h3>
<p>Well, there is no easy way to get this done but here is a possible option: create a management command that can be run in the zappa environment.  </p>
<h4 id="create-a-management-command-in-your-django-project">Create a management command in your Django Project<a class="headerlink" href="#create-a-management-command-in-your-django-project" title="Permanent link">&para;</a></h4>
<p>Follow these steps to create a management command environment (make sure your virtualenv is fired up)</p>
<div class="codehilite"><pre><span></span><span class="nb">cd</span> frankie
python manage.py startapp axe
<span class="nb">cd</span> axe
mkdir management
<span class="nb">cd</span> management
touch __init.py__
mkdir commands
<span class="nb">cd</span> commands
touch __init.py__
</pre></div>

<p>Then create a file called <code>create_db.py</code></p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">psycopg2</span> <span class="kn">import</span> <span class="n">connect</span>
<span class="kn">from</span> <span class="nn">psycopg2.extensions</span> <span class="kn">import</span> <span class="n">ISOLATION_LEVEL_AUTOCOMMIT</span>
<span class="kn">from</span> <span class="nn">django.core.management.base</span> <span class="kn">import</span> <span class="n">BaseCommand</span><span class="p">,</span> <span class="n">CommandError</span>
<span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>

<span class="k">class</span> <span class="nc">Command</span><span class="p">(</span><span class="n">BaseCommand</span><span class="p">):</span>
    <span class="n">help</span> <span class="o">=</span> <span class="s1">&#39;Creates the initial database&#39;</span>

    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">SUCCESS</span><span class="p">(</span><span class="s1">&#39;Starting db creation&#39;</span><span class="p">))</span>

        <span class="n">dbname</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">DATABASES</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">][</span><span class="s1">&#39;NAME&#39;</span><span class="p">]</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">DATABASES</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">][</span><span class="s1">&#39;USER&#39;</span><span class="p">]</span>
        <span class="n">password</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">DATABASES</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">][</span><span class="s1">&#39;PASSWORD&#39;</span><span class="p">]</span>
        <span class="n">host</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">DATABASES</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">][</span><span class="s1">&#39;HOST&#39;</span><span class="p">]</span>

        <span class="n">con</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="n">dbname</span><span class="o">=</span><span class="s1">&#39;postgres&#39;</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> <span class="n">host</span> <span class="o">=</span> <span class="n">host</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>
        <span class="n">dbname</span> <span class="o">=</span> <span class="n">dbname</span>
        <span class="n">con</span><span class="o">.</span><span class="n">set_isolation_level</span><span class="p">(</span><span class="n">ISOLATION_LEVEL_AUTOCOMMIT</span><span class="p">)</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;CREATE DATABASE &#39;</span> <span class="o">+</span> <span class="n">dbname</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">SUCCESS</span><span class="p">(</span><span class="s1">&#39;All Done&#39;</span><span class="p">))</span>
</pre></div>

<h4 id="run-the-management-command">Run the management command<a class="headerlink" href="#run-the-management-command" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span>zappa dev manage create_db
</pre></div>

<p>If all goes well, then your database should be created.</p>
<h2 id="init-the-database">Init the Database<a class="headerlink" href="#init-the-database" title="Permanent link">&para;</a></h2>
<p>At this point you should have an empty database ready for your Django application to fill up with schema. If this were a traditional server, you would merely run the <code>migrate</code> command.  But you can't because there is no command line.  Thus we have to modify them to adjust to the new environment.</p>
<p>So create your migrations and push the updated code.  </p>
<p><div class="codehilite"><pre><span></span>python manage.py makemigrations
zappa update dev
</pre></div>
Now you invoke the zappa manage command:</p>
<div class="codehilite"><pre><span></span>zappa manage dev migrate
</pre></div>

<p>And repeat this process every time you make model changes.</p>
<h2 id="create-your-django-superuser">Create your Django superuser<a class="headerlink" href="#create-your-django-superuser" title="Permanent link">&para;</a></h2>
<p>The Django management commands were meant to be run interactively on a command line on a traditional server.  Because there is no command line with lambda, we must do some trickery to get around the input needed for the Django createsuperuser management command.</p>
<p>Essentially we will use the <code>raw</code> flag on the invoke command to just run raw python.  The following command creates a new superuser named 'admin' with email 'admin@yourdomain.com' and password of 'horse battery stapler'</p>
<div class="codehilite"><pre><span></span>zappa invoke --raw dev <span class="s2">&quot;from django.contrib.auth.models import User; User.objects.create_superuser(&#39;admin&#39;, &#39;admin@yourdomain.com&#39;, &#39;horse battery stapler&#39;)&quot;</span>
</pre></div>

<p>Additional superusers can be added via this method or the Django admin console.</p>
<h2 id="test-and-profit">Test and profit<a class="headerlink" href="#test-and-profit" title="Permanent link">&para;</a></h2>
<p>At this point you should be able to log into your Django admin:
<img alt="Database FTW" src="../images/db_success.png" /></p>
<p>(http://marcelog.github.io/articles/aws_lambda_internet_vpc.html)</p>
<p>[https://www.isc.upenn.edu/accessing-mysql-databases-aws-python-lambda-function]</p>
<h1 id="further-topics">Further Topics<a class="headerlink" href="#further-topics" title="Permanent link">&para;</a></h1>
<h2 id="security">Security<a class="headerlink" href="#security" title="Permanent link">&para;</a></h2>
<p>Notice that we are using the master user credentials for the RDS system.  It would be more secure if we created a dedicated user that can only access the relevant database.  More information on that can be found here:
<a href="https://www.digitalocean.com/community/tutorials/how-to-use-postgresql-with-your-django-application-on-ubuntu-14-04">https://www.digitalocean.com/community/tutorials/how-to-use-postgresql-with-your-django-application-on-ubuntu-14-04</a></p>
<p>You will have to modify your custom Django management command to accommodate creation of a new user.</p>
<h2 id="additional-references">Additional References<a class="headerlink" href="#additional-references" title="Permanent link">&para;</a></h2>
<p>For MySQL tips:
<a href="https://www.digitalocean.com/community/tutorials/how-to-use-postgresql-with-your-django-application-on-ubuntu-14-04">https://www.digitalocean.com/community/tutorials/how-to-use-postgresql-with-your-django-application-on-ubuntu-14-04</a></p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../walk_static/" title="Hosting Static Files" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Hosting Static Files
              </span>
            </div>
          </a>
        
        
          <a href="../walk_domain/" title="Custom Domains" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Custom Domains
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2016 - 2017 <a href="https://github.com/edgarroman">Edgar Roman</a>
          </div>
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="https://github.com/edgarroman" class="md-footer-social__link fa fa-github"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application-c35428f87f.js"></script>
      
      
      <script>app.initialize({url:{base:".."}})</script>
      
    
    
      
      <script>!function(e,t,a,n,o,c,i){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,c=t.createElement(a),i=t.getElementsByTagName(a)[0],c.async=1,c.src=n,i.parentNode.insertBefore(c,i)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-97437653-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var t=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",t,e.href)})});var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})</script>
      
    
  </body>
</html>